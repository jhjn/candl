<form action="/api/edit/{{.Name}}" id="pad" method="post">
    <div class="editor-container">
        <div class="highlight-layer" id="highlight"></div> <!-- highlight layer underneath -->
        <textarea name="body" id="editor" autofocus spellcheck="false" placeholder="creating /{{.Name}} ...">{{.Markdown}}</textarea>
    </div>
    <input type="text" id="name-input" class="btn" name="name" value="{{.Name}}" spellcheck="false" style="padding: 10px 10px">
    <input type="submit" id="save-btn" class="btn btn-blue" value="save">
    <script>
        const editor = document.getElementById('editor');
        const highlight = document.getElementById('highlight');
        const form = document.getElementById('pad');
        
        // Cmd-Enter to save
        editor.addEventListener('keydown', function(e) {
            // Check for Cmd+Enter (Mac) or Ctrl+Enter (Windows/Linux)
            if ((e.metaKey || e.ctrlKey) && e.key === 'Enter') {
                e.preventDefault();
                form.submit();
            }
        });

        // Add highlights to text
        function escapeHtml(text) {
          return text
            .replace(/&/g, '&amp;')
            .replace(/</g, '&lt;')
            .replace(/>/g, '&gt;')
            .replace(/"/g, '&quot;')
            .replace(/'/g, '&#039;');
        }
        
        function updateHighlight() {
          const text = escapeHtml(editor.value);
          const highlighted = text.replace(
            /\[\[([^\]]+)\]\]/g,
            '<span class="wiki-link">[[$1]]</span>'
          ).replace(
            /(?:^|\n)(#+\s*[^\n]+)/g,
            '<span class="header">$1</span>'
          ).replace(
            /(`[^`]+`)/g,
            '<span class="code">$1</span>'
          );
          highlight.innerHTML = highlighted;
          syncScroll();
        }
        
        function syncScroll() {
          highlight.scrollTop = editor.scrollTop;
          highlight.scrollLeft = editor.scrollLeft;
        }
        
        editor.addEventListener('input', updateHighlight);
        editor.addEventListener('scroll', syncScroll);
        
        updateHighlight();
    </script>
</form>
